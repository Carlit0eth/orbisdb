(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[845],{6567:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/plugins/[plugin_id]",function(){return s(7166)}])},5563:function(e,t,s){"use strict";s.d(t,{Z:function(){return Alert}});var l=s(4246);function Alert(e){let{title:t,className:s="text-base mb-4",color:n="amber"}=e;return(0,l.jsx)("div",{className:"rounded-md border-dashed border px-6 py-2 justify-center flex ".concat("bg-"+n+"-100 border-"+n+"-200 text-"+n+"-800"," ").concat(s),children:(0,l.jsx)("span",{className:"text-center",children:t})})}},2884:function(e,t,s){"use strict";s.d(t,{Z:function(){return InternalNavigation}});var l=s(4246);function InternalNavigation(e){let{items:t=[],nav:s,setNav:n}=e;return(0,l.jsx)("div",{className:"flex flex-row items-center rounded-full bg-white border border-slate-200 px-6 py-1.5 space-x-8",children:t.map(e=>(0,l.jsx)("button",{onClick:()=>e.active&&n(e.label),disabled:!e.active,className:"text-sm focus:outline-none flex flex-row items-center space-x-1\n             ".concat(e.label===s?"text-[#4483FD] font-medium":"text-[#666666] cursor-pointer hover:underline","\n             ").concat(e.active?"":"text-[#C2C2C2] cursor-not-allowed"),children:e.title?e.title:e.label},e.label))})}s(7378)},7166:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PluginDetails}});var l=s(4246),n=s(7378),a=s(9894),i=s.n(a),r=s(6640),o=s(814);s(917);var c=s(5563),x=s(662);function PluginVariables_LoopPluginVariables(e){let{variables:t,defaultVariables:s,per_context:n}=e;return null==t?void 0:t.map((e,t)=>(0,l.jsx)(PluginVariable,{variable:e,defaultVariables:s,per_context:n},t))}let PluginVariable=e=>{let{variable:t,defaultVariables:s,per_context:a}=e,[i,r]=(0,n.useState)(s?s[t.id]:"");if(!0==a){if(!t.per_context)return null}else if(t.per_context)return null;return(0,l.jsxs)("div",{className:"flex flex-col mb-4",children:[(0,l.jsxs)("p",{className:"text-base font-medium text-slate-900",children:[t.name,":"]}),t.description&&(0,l.jsx)("p",{className:"text-base text-slate-500",children:t.description}),(0,l.jsx)(VariableInput,{variable:t,val:i,setVal:r})]})},VariableInput=e=>{let{variable:t,val:s,setVal:n}=e;console.log("variable:",t);let a=(0,l.jsx)("input",{type:"text",placeholder:t.name,name:t.id,value:s,onChange:e=>n(e.target.value),className:"bg-white px-2 py-1 rounded-md border border-slate-300 text-base text-slate-900 mt-1 ".concat(t.private&&"private-input")});switch(t.type){case"array":a=(0,l.jsx)("textarea",{placeholder:t.name,name:t.id,value:s,onChange:e=>n(e.target.value),className:"bg-white px-2 py-1 rounded-md border border-slate-300 text-base text-slate-900 mt-1 ".concat(t.private&&"private-input")});break;case"object":a=(0,l.jsx)("textarea",{placeholder:t.name,name:t.id,value:s,onChange:e=>n(e.target.value),className:"bg-white px-2 py-1 rounded-md border border-slate-300 text-base text-slate-900 mt-1 ".concat(t.private&&"private-input")})}return a};var d=s(7737);function PluginSettingsModal(e){let{pluginDetails:t,defaultVariables:s,hide:n,savePlugin:a,status:i}=e;return(0,l.jsx)(x.Z,{hide:n,title:"Plugin settings",description:"Those private settings are required for the plugin to work and will never be exposed to external actors.",style:{overflowY:"scroll",maxHeight:"90%"},children:(0,l.jsxs)("form",{onSubmit:a,children:[t.variables&&(0,l.jsx)(PluginVariables_LoopPluginVariables,{variables:t.variables,defaultVariables:s,per_context:!1}),(0,l.jsx)("div",{className:"flex flex-row justify-center",children:(0,l.jsx)(d.Z,{title:"Save",status:i,successTitle:"Saved"})})]})})}var u=s(3279),m=s(8709);function AssignContextModal(e){let t,{hide:s,plugin_id:a,selectedContext:i}=e,{settings:o,setSettings:c}=(0,n.useContext)(r.k),[p,g]=(0,n.useState)(u.Q_.ACTIVE),[f,h]=(0,n.useState)(),[v,b]=(0,n.useState)([]),[j,N]=(0,n.useState)(i?2:1);function nextStep(){if(!v||0==v.length)return alert("Please select a context first."),null;N(2)}async function saveOrUpdateContext(){if(event.preventDefault(),(!v||0==v.length)&&!i)return alert("Please select a context first."),null;g(u.Q_.LOADING);let e=event.target,t=new FormData(e),l={};for(let[e,s]of t.entries())l[e]=s;console.log("Variables:",l);let n={plugin_id:a,variables:l};i?n.context_id=i.context:n.path=v;let r=await fetch("/api/settings/assign-context",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});console.log("response:",r=await r.json()),g(u.Q_.SUCCESS),c(r.settings),await (0,u._v)(1500),s()}return(0,n.useEffect)(()=>{a&&loadPluginDetails();async function loadPluginDetails(){try{let e=await fetch("/api/plugins/"+a);e=await e.json(),console.log("plugin details:",e),200==e.status?h(e.plugin):console.log("Error retrieving plugin details.")}catch(e){console.log("Error retrieving plugin details:",e)}}},[a]),(0,l.jsxs)(x.Z,{hide:s,title:i?"Update the context settings":"Assign to a new context",description:i?"Update the plugin settings for this context.":"Assign this plugin to a new context.",children:[!i&&(0,l.jsx)("div",{className:"w-full mt-6",children:(0,l.jsx)(m.Z,{steps:["Select your context","Settings"],currentStep:j})}),1==j&&(0,l.jsxs)("div",{className:"mt-4",children:[v&&v.length>=1?(0,l.jsx)(l.Fragment,{children:[...v,{}].map((e,t)=>(0,l.jsx)(ContextDropdown,{index:t,plugin_id:a,selectedContext:e,selectedContextIds:v,setSelectedContextIds:b}))}):(0,l.jsx)(ContextDropdown,{selectedContextIds:v,plugin_id:a,setSelectedContextIds:b}),(0,l.jsx)("div",{className:"flex flex-row justify-center mt-4",children:v&&0!=v.length?(0,l.jsx)(l.Fragment,{children:function(e,t){var s;let{settings:l}=(0,n.useContext)(r.k),a=null===(s=l.plugins)||void 0===s?void 0:s.find(t=>t.plugin_id===e);return!!a&&!!a.contexts&&a.contexts.some(e=>e.context===t)}(a,(console.log("last_context:",t=v[v.length-1]),t))&&p!=u.Q_.SUCCESS?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(d.Z,{title:"Next",onClick:()=>nextStep()})}):(0,l.jsx)(d.Z,{title:"Next",onClick:()=>nextStep()})}):(0,l.jsx)(d.Z,{title:"Next",status:u.Q_.DISABLED})})]}),2==j&&(0,l.jsxs)("form",{onSubmit:saveOrUpdateContext,className:"mt-6 flex flex-col",children:[(null==f?void 0:f.variables)?(0,l.jsx)(PluginVariables_LoopPluginVariables,{variables:null==f?void 0:f.variables,defaultVariables:i?i.variables:null,per_context:!0}):(0,l.jsx)("div",{className:"bg-amber-100 rounded-md border-dashed border border-amber-200 w-full py-2 justify-center flex mb-4",children:(0,l.jsx)("span",{className:"text-center text-amber-800 text-base",children:"There aren't any contextualized variables to setup for this plugin."})}),(0,l.jsx)("div",{className:"flex flex-row justify-center",children:v&&v.length>0||i.context?(0,l.jsx)(d.Z,{title:"Save",status:p,successTitle:"Saved"}):(0,l.jsx)(d.Z,{title:"Context already used",status:u.Q_.DISABLED})})]})]})}let ContextDropdown=e=>{let{selectedContext:t,selectedContextIds:s,setSelectedContextIds:a,index:i,plugin_id:c}=e,{settings:x}=(0,n.useContext)(r.k),[d,m]=(0,n.useState)(!1);s[i];let p=(0,u.SL)(x.contexts,s[i-1]),g=(null==p?void 0:p.contexts)?p.contexts:x.contexts,f=(0,u.SL)(x.contexts,t);return!p||p&&p.contexts&&0!=p.contexts.length?(0,l.jsxs)("div",{className:"w-full relative mb-2",children:[(0,l.jsxs)("div",{className:"flex flex-row bg-white px-2 py-1 rounded-md border border-slate-300 hover:border-slate-400 cursor-pointer text-base text-slate-900 mt-1 items-center",onClick:()=>m(!d),children:[f?(0,l.jsx)("span",{className:"flex flex-1",children:(0,l.jsx)(SmContextDetails,{context:f})}):(0,l.jsx)("span",{className:"flex flex-1",children:"Select your context"}),(0,l.jsx)("span",{className:"flex justify-self-end inset-y-0 right-0 ml-3 flex items-center",children:(0,l.jsx)(o.Wi,{})})]}),d&&(0,l.jsx)("ul",{className:"absolute z-10 mt-1 max-h-56 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",tabIndex:"-1",role:"listbox","aria-labelledby":"listbox-label",children:g.map((e,n)=>(0,l.jsx)("li",{className:"relative select-none py-2 pl-3 pr-9 text-gray-900 hover:bg-slate-50 cursor-pointer",role:"option",onClick:()=>{let l;return m(!1),l=[],void(t?((l=[...s])[i]=e.stream_id,l.splice(i+1)):l=[...s,e.stream_id],a(l),console.log("newContexts:",l))},children:(0,l.jsx)(SmContextDetails,{context:e})},n))})]}):null},SmContextDetails=e=>{let{context:t}=e;return(0,l.jsxs)("div",{className:"flex items-center",children:[t.logo&&(0,l.jsx)("img",{src:t.logo,alt:t.name,className:"h-5 w-5 flex-shrink-0 mr-1.5 rounded-full"}),(0,l.jsx)("span",{className:"font-normal block truncate",children:t.name})]})};var p=s(2884),g=s(6677),hooks_useContextDetails=e=>{let{settings:t}=(0,n.useContext)(r.k),s=(0,u.SL)(t.contexts,e),l=null==s?void 0:s.name,a=null==s?void 0:s.logo;return{name:l,logo:a}};function PluginDetails(){var e,t,s;let{settings:a,setSettings:i}=(0,n.useContext)(r.k),[x,m]=(0,n.useState)(!1),[f,h]=(0,n.useState)(),[v,b]=(0,n.useState)(u.Q_.ACTIVE),[j,N]=(0,n.useState)(),[w,y]=(0,n.useState)(!1),[C,S]=(0,n.useState)("Overview"),[_,k]=(0,n.useState)(!1),[P,D]=(0,n.useState)(!1),[E,V]=(0,n.useState)(null),F=(0,g.useRouter)(),{plugin_id:I}=F.query,O=a.plugins.findIndex(e=>e.plugin_id===I);async function savePlugin(){b(u.Q_.LOADING),event.preventDefault();let e=event.target,t=new FormData(e),s={};for(let[e,l]of t.entries())s[e]=l;try{let e=await fetch("/api/settings/install-plugin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plugin:{plugin_id:I,variables:s}})});e=await e.json(),console.log("plugin added:",e),200==e.status?(b(u.Q_.SUCCESS),i(e.updatedSettings),y(!0),await (0,u._v)(1500),k(!1)):console.log("Error adding plugin.")}catch(e){console.log("Error adding plugin:",e)}console.log("Form data submitted:",s)}return(0,n.useEffect)(()=>{I&&loadPluginDetails();async function loadPluginDetails(){try{let e=await fetch("/api/plugins/"+I);e=await e.json(),console.log("plugin details:",e),200==e.status?h(e.plugin):console.log("Error retrieving plugin details.")}catch(e){console.log("Error retrieving plugin details:",e)}-1!==O&&(y(!0),N(a.plugins[O].variables))}},[I]),(0,l.jsxs)("div",{className:"flex flex-row space-x-8",children:[(0,l.jsx)("div",{className:"px-16 py-12 md:w-2/3",children:f?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex flex-row items-center",children:[f.logo&&(0,l.jsx)("img",{src:f.logo,className:"mr-3 h-20 w-20 rounded-md"}),(0,l.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:f.name})]}),(0,l.jsx)("div",{className:"flex justify-start mt-3 mb-3",children:(0,l.jsx)(p.Z,{items:[{label:"Overview",active:!0},{label:"Contexts",active:w}],nav:C,setNav:S})}),"Overview"==C&&(0,l.jsx)("p",{className:"text-slate-600 mt-1 text-base",children:f.full_description?f.full_description:f.description}),"Contexts"==C&&(0,l.jsxs)(l.Fragment,{children:[a.plugins&&(null===(t=a.plugins[O])||void 0===t?void 0:null===(e=t.contexts)||void 0===e?void 0:e.length)>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"text-slate-600 mt-3 text-base",children:"Enable this plugin on your contexts to start using it:"}),(0,l.jsx)("div",{className:"flex flex-row flex-wrap mt-2 items-start",children:null===(s=a.plugins[O].contexts)||void 0===s?void 0:s.map((e,t)=>(0,l.jsx)(OneContext,{context:e,setSelectedContext:V,pluginDetails:f},t))})]}):(0,l.jsx)(c.Z,{title:"You haven't assigned this plugin to a context yet."}),(0,l.jsx)("div",{className:"flex w-full justify-center mt-4",children:(0,l.jsx)(d.Z,{type:"secondary",title:"Assign to a new context",onClick:()=>D(!0)})})]}),"Settings"==C&&(0,l.jsx)("div",{className:"flex flex-col space-y-4 mt-4 lg:w-2/5",children:(0,l.jsxs)("form",{onSubmit:savePlugin,children:[f.variables&&(0,l.jsx)(LoopPluginVariables,{variables:f.variables,defaultVariables:j}),(0,l.jsx)("div",{className:"flex flex-row justify-center",children:(0,l.jsx)(d.Z,{title:"Save",status:v,successTitle:"Saved"})})]})})]}):(0,l.jsx)("p",{children:"Loading..."})}),f&&(0,l.jsx)("div",{className:"flex flex-col py-12 md:w-1/3 pr-16",children:(0,l.jsxs)("div",{className:"rounded-md bg-white border border-slate-200 p-6 py-5 w-full",children:[(0,l.jsx)("h2",{className:"font-medium text-lg",children:"Installation"}),(0,l.jsx)("p",{className:"text-slate-500 text-base",children:"Install this plugin to start using it on your contexts."}),(0,l.jsx)("p",{className:"text-base font-medium mt-3 mb-0.5",children:"Hooks used:"}),(0,l.jsx)("div",{className:"flex flex-row space-x-2",children:f.hooks&&f.hooks.map((e,t)=>(0,l.jsx)("div",{className:"bg-slate-100 rounded-full px-3 py-1 text-xs font-medium text-slate-800",children:e},t))}),(0,l.jsx)("div",{className:"flex flex-row mt-4 justify-center",children:w?(0,l.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,l.jsxs)("div",{className:"bg-green-500 text-white text-sm px-2.5 py-1.5 rounded-md font-medium pointer flex flex-row items-center justify-center space-x-1",children:[(0,l.jsx)(o.nQ,{})," ",(0,l.jsx)("span",{children:"Plugin installed"})]}),(0,l.jsx)("div",{className:"text-slate-900 hover:underline text-sm cursor-pointer font-medium",onClick:()=>k(!0),children:"Update plugin setings"})]}):(0,l.jsx)(d.Z,{title:w?"Update plugin settings":"Install plugin",status:v,successTitle:"Plugin added",onClick:()=>k(!0)})})]})}),_&&(0,l.jsx)(PluginSettingsModal,{hide:()=>k(!1),savePlugin:savePlugin,status:v,pluginDetails:f,defaultVariables:j}),P&&(0,l.jsx)(AssignContextModal,{hide:()=>D(!1),plugin_id:I}),null!=E&&(0,l.jsx)(AssignContextModal,{hide:()=>V(null),selectedContext:E,plugin_id:I})]})}let OneContext=e=>{let{context:t,setSelectedContext:s,pluginDetails:a}=e,{settings:c}=(0,n.useContext)(r.k);return(0,l.jsxs)("div",{className:"rounded-md bg-white border border-slate-200 flex flex-col overflow-hidden mb-3 mr-3 min-w-[170px] max-w-[350px]",children:[(0,l.jsx)("div",{className:"flex flex-row px-4 py-3 items-center space-x-1.5",children:t.path.map((e,s)=>{let{name:n,logo:a}=hooks_useContextDetails(e);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center",children:[a&&(0,l.jsx)("img",{src:a,alt:n,className:"h-5 w-5 flex-shrink-0 mr-1.5 rounded-full"}),(0,l.jsx)("span",{className:"text-base font-normal block truncate",children:n})]}),e!=t.context&&(0,l.jsx)(o.yh,{})]})})}),t.variables&&(0,l.jsx)("div",{className:"flex flex-col px-4 text-sm border-t border-slate-100 py-2 text-slate-600 space-y-1",children:Object.entries(t.variables).map(e=>{let[t,s]=e;return(0,l.jsxs)("div",{className:"font-mono text-xxs truncate",children:[(0,l.jsxs)("span",{className:"font-bold text-slate-900",children:[t,":"]})," ",(0,l.jsx)("span",{className:"truncate",children:s})]},t)})}),a.routes&&(0,l.jsxs)("div",{className:"flex flex-row bg-[#FBFBFB] text-[#989494] hover:text-[#807878] text-sm cursor-pointer border-t border-slate-200 space-x-1 px-3 py-1.5 items-center justify-center",onClick:()=>s(t),children:[(0,l.jsx)("div",{className:"mr-1 font-medium",children:"Routes:"}),(0,l.jsx)(l.Fragment,{children:a.routes.map((e,s)=>(0,l.jsxs)(i(),{href:"/api/plugins/"+a.id+"/"+t.context+"/"+e,target:"_blank",className:"bg-white border border-slate-200 hover:border-[#4483FD]  rounded-md px-3 py-2 text-xs font-medium text-slate-800 space-x-1 flex flex-row items-center",children:[(0,l.jsx)(o.h0,{}),(0,l.jsxs)("span",{className:"font-mono",children:["/",e]})]},s))})]}),(0,l.jsxs)("div",{className:"flex flex-row bg-[#FBFBFB] text-[#989494] hover:text-[#807878] cursor-pointer border-t border-slate-200 space-x-1 px-3 py-1.5 items-center justify-center",onClick:()=>s(t),children:[(0,l.jsx)(o.ew,{}),(0,l.jsx)("span",{className:"text-sm font-medium",children:"Configure"})]})]})}}},function(e){e.O(0,[917,774,888,179],function(){return e(e.s=6567)}),_N_E=e.O()}]);