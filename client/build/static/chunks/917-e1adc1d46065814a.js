"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[917],{917:function(e,t,s){s.d(t,{Z:function(){return AddModelModal}});var n=s(4246),a=s(7378),r=s(6640),l=s(662),i=s(7737),o=s(8709),c=s(3279);function AddModelModal(e){let{setAddModalVis:t}=e,[s,r]=(0,a.useState)(1);return(0,n.jsx)(l.Z,{hide:()=>t(!1),children:(0,n.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,n.jsx)("h2",{className:"text-center font-medium mb-1",children:"Start indexing a new model"}),(0,n.jsx)("p",{className:"text-center text-slate-500 text-base mb-2",children:"This will archive the model's streams in your Ceramic node as well as start indexing those in your database."}),(0,n.jsx)("div",{className:"w-full",children:(0,n.jsx)(o.Z,{steps:["Add your model","Get model details","Setup indexing"],currentStep:s})}),(0,n.jsx)(AddModelSteps,{step:s,setStep:r,setAddModalVis:t})]})})}let AddModelSteps=e=>{let{step:t,setStep:s,setAddModalVis:l}=e,{orbis:o,setSettings:d}=(0,a.useContext)(r.k),[m,u]=(0,a.useState)(""),[x,p]=(0,a.useState)(c.Q_.ACTIVE),[f,h]=(0,a.useState)();async function loadModelDetails(){p(c.Q_.LOADING);try{let e=await o.ceramic.loadStream(m);console.log("stream.state:",e.state),e&&h(e.state.content),p(c.Q_.SUCCESS),await (0,c._v)(500),s(2),p(c.Q_.ACTIVE)}catch(e){alert("Couldn't load model details."),console.log("Error adding new model to the settings file:",e),p(c.Q_.ERROR),await (0,c._v)(500),p(c.Q_.ACTIVE)}}async function saveInSettings(){p(c.Q_.LOADING);try{let e=await fetch("/api/settings/add-model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:{name:f.name?f.name:f.title,stream_id:m,status:0}})});e=await e.json(),console.log("response:",e),200==e.status?(d(e.settings),p(c.Q_.SUCCESS),await (0,c._v)(500),s(c.Q_.ERROR),p(0)):p(c.Q_.ERROR)}catch(e){console.log("Error saving model in settings."),p(c.Q_.ERROR)}}async function startIndexing(){p(c.Q_.LOADING);try{let e=await fetch("/api/settings/index-model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({modelId:m})});e=await e.json(),console.log("response in startIndexing:",e),200==e.status?(d(e.settings),p(c.Q_.SUCCESS),await (0,c._v)(500),l(!1)):p(c.Q_.ERROR)}catch(e){console.log("Error saving model in settings."),p(3)}}switch(t){case 1:return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("input",{type:"text",placeholder:"Model ID",className:"bg-white px-2 py-1 rounded-md border border-slate-300 text-base text-slate-900 mb-2",onChange:e=>u(e.target.value),value:m}),(0,n.jsx)(i.Z,{type:"primary",onClick:()=>loadModelDetails(!0),status:x,title:"Load details"})]});case 2:return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{className:"text-base text-slate-500 mb-2",children:["Model name: ",(0,n.jsx)("span",{className:"font-medium text-slate-900",children:f.name?f.name:f.title})]}),(0,n.jsx)(i.Z,{type:"primary",onClick:()=>saveInSettings(),status:x,title:"Save"})]});case 3:return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-base text-slate-900 mb-3 text-center",children:"We will now initialize the indexing of this model which is going to create a new table in your database with those fields."}),(0,n.jsx)("div",{className:"mb-3 justify-center flex",children:f.schema?(0,n.jsx)(SchemaDetails,{content:f,properties:f.schema.properties}):(0,n.jsx)("p",{className:"rounded-md p-2 bg-slate-50 text-center w-full",children:"This stream is not a model."})}),(0,n.jsx)(i.Z,{type:"primary",onClick:()=>startIndexing(),status:x,title:"Start indexing"})]})}},SchemaDetails=e=>{let{content:t,properties:s}=e;return s?(0,n.jsx)("ul",{className:"space-y-3 text-sm",children:(0,n.jsx)(SchemaType,{properties:Object.entries(s),isParent:!0})}):(0,n.jsx)("p",{className:"text-gray-500 text-md",children:"We couldn't find any property for this schema."})},ValueDetails=e=>{let{val:t}=e;return Array.isArray(t)?t.map((e,t)=>e?(0,n.jsxs)(n.Fragment,{children:[":",(0,n.jsx)("span",{className:"rounded-md px-2 py-1 bg-slate-100 text-gray-600 mr-1.5",children:e},t)]}):null):t?(0,n.jsxs)(n.Fragment,{children:[":",(0,n.jsx)("span",{className:"rounded-md px-2 py-1 bg-slate-100 text-gray-600",children:t})]}):null},SchemaType=e=>{let{properties:t,isParent:s}=e;return t.map(e=>{var t;let[a,r]=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:s?"text-gray-900 font-mono":"text-gray-500 font-mono",children:a})," ",(0,n.jsx)(ValueDetails,{val:r.type})]},a),(null==r?void 0:null===(t=r.type)||void 0===t?void 0:t.includes("object"))&&r.properties&&(0,n.jsx)("div",{className:"pl-4 mt-2 border-l border-gray-200 space-y-2",children:(0,n.jsx)(SchemaType,{properties:Object.entries(r.properties),isParent:!1})})]})})}},662:function(e,t,s){s.d(t,{Z:function(){return Modal}});var n=s(4246),a=s(7378);function Modal(e){var t;let{hide:s,children:r,title:l,description:i,style:o,className:c}=e,d=(0,a.useRef)(null);return t=()=>s(),(0,a.useEffect)(()=>{let listener=e=>{!d.current||d.current.contains(e.target)||t(e)};return document.addEventListener("mousedown",listener),document.addEventListener("touchstart",listener),()=>{document.removeEventListener("mousedown",listener),document.removeEventListener("touchstart",listener)}},[d,t]),(0,n.jsxs)("div",{className:"relative z-10","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",style:o,children:[(0,n.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity blur-md backdrop-blur-sm cursor-pointer"}),(0,n.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,n.jsx)("div",{className:"flex min-h-full items-start justify-center p-6 text-center sm:p-0 ",children:(0,n.jsxs)("div",{className:"relative transform rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 w-96 sm:p-6 "+c,ref:d,children:[l&&(0,n.jsx)("h2",{className:"text-center font-medium mb-1 w-full",children:l}),i&&(0,n.jsx)("p",{className:"text-slate-500 text-base w-full text-center mb-1",children:i}),r]})})})]})}},8709:function(e,t,s){s.d(t,{Z:function(){return StepsProgress}});var n=s(4246);function StepsProgress(e){let{steps:t=[],currentStep:s=1}=e;return(0,n.jsx)("ol",{className:"relative flex items-center w-full text-sm font-medium text-center mt-4 mb-3 justify-center",children:t.map((e,a)=>(0,n.jsxs)("li",{className:"flex items-center justify-center ".concat(a<t.length-1?"mr-2":""),children:[(0,n.jsxs)("span",{className:"flex justify-end flex-col items-center",children:[s==a+1&&(0,n.jsx)("span",{className:"text-sm text-[#4483FD] absolute",style:{top:-17},children:e}),(0,n.jsx)("span",{className:"rounded-full h-3 w-3 mt-1 ".concat(s>=a+1?"bg-[#4483FD]":"bg-slate-200")})]}),a<t.length-1&&(0,n.jsx)("span",{className:"h-1 border-b ml-2 w-16 ".concat(s>a+1?"border-[#4483FD]":"border-slate-200")})]},a))})}},3279:function(e,t,s){s.d(t,{Q_:function(){return n},SL:function(){return function findContextById(e,t){if(e&&Array.isArray(e))for(let s of e){if(s.stream_id===t)return s;if(s.contexts&&Array.isArray(s.contexts)){let e=findContextById(s.contexts,t);if(e)return e}}return null}},_v:function(){return sleep},d2:function(){return getPluginsByContext},oK:function(){return findParentContextId}}),s(7378),s(6640);let sleep=e=>new Promise(t=>setTimeout(t,e)),getPluginsByContext=(e,t)=>{let s=[],n=[],a=((e,t)=>{for(let s of t)if(s.contexts){for(let t of s.contexts)if(t.context===e)return t.path.slice(0,-1)}return[]})(e,t);return t.forEach(t=>{var r;null==t||null===(r=t.contexts)||void 0===r||r.forEach(r=>{let l=r.context===e,i=a.includes(r.context),o=JSON.parse(JSON.stringify(t));delete o.contexts,l?s.push({...o,contextType:"Direct",installedContextId:r.context}):i&&n.push({...o,contextType:"Parent",installedContextId:r.context})})}),{direct:s,parent:n}},findParentContextId=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||0===t.length)return null;for(let n of t){if(n.stream_id===e)return s;if(n.contexts){let t=findParentContextId(e,n.contexts,n.stream_id);if(t)return t}}return null},n={ACTIVE:0,LOADING:1,SUCCESS:2,ERROR:3,DISABLED:4}}}]);