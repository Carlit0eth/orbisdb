"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[478],{9239:function(t,n,s){s.d(n,{Co:function(){return countSubContexts},GH:function(){return PluginsCountTag},ZP:function(){return ContextDetails},sB:function(){return countPluginsByContext}});var l=s(4246),r=s(9894),o=s.n(r),a=s(7378),i=s(6640),c=s(3279);function ContextDetails(t){let{context:n}=t;return(0,l.jsxs)("div",{className:"flex flex-row bg-white px-4 py-3 border border-slate-200 rounded-md items-center",children:[n.logo&&(0,l.jsx)("img",{src:n.logo,alt:n.name,className:"h-14 w-14 flex-shrink-0 mr-3 rounded-md"}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)(o(),{className:"text-[#4483FD] font-medium text-base hover:underline",href:"/contexts/"+n.stream_id,children:n.name}),(0,l.jsx)(SubContextsCountTag,{context_id:n.stream_id})]})]})}let SubContextsCountTag=t=>{let{context_id:n}=t;return(0,l.jsxs)("div",{className:"bg-slate-100 rounded-full px-3 py-1 text-xs font-medium text-slate-800 mr-1",children:[countSubContexts(n)," sub-context(s)"]})},PluginsCountTag=t=>{let{context_id:n}=t;return(0,l.jsxs)("div",{className:"bg-slate-100 rounded-full px-3 py-1 text-xs font-medium text-slate-800",children:[countPluginsByContext(n)," plugin(s)"]})},countPluginsByContext=t=>{let{settings:n}=(0,a.useContext)(i.k),s=(0,c.d2)(t,n.plugins);return console.log("results:",s),s.direct.length+s.parent.length},countSubContexts=(t,n)=>{let s;let{settings:l}=(0,a.useContext)(i.k);s=n||l.contexts;let findContext=(t,n)=>{for(let s of n){if(s.stream_id===t)return s;if(s.contexts){let n=findContext(t,s.contexts);if(n)return n}}return null},r=findContext(t,s);if(!r||!r.contexts||0===r.contexts.length)return 0;let o=r.contexts.length;for(let t of r.contexts)o+=countSubContexts(t.stream_id,r.contexts);return o}},5620:function(t,n,s){s.d(n,{Z:function(){return ContextSettings}});var l=s(4246),r=s(7378),o=s(7737),a=s(6640),i=s(3279);function ContextSettings(t){let{context:n,setContext:s,callback:c,parentContext:d}=t,{orbis:x,settings:u,setSettings:f}=(0,r.useContext)(a.k),[m,p]=(0,r.useState)(i.Q_.ACTIVE),[g,h]=(0,r.useState)((null==n?void 0:n.name)?n.name:""),[C,b]=(0,r.useState)((null==n?void 0:n.logo)?n.logo:null),[v,j]=(0,r.useState)((null==n?void 0:n.logo)?n.logo:null),[y,w]=(0,r.useState)((null==n?void 0:n.description)?n.description:""),S=(0,r.useRef)(null);async function selectLogo(){S.current.click()}let uploadToServer=async t=>{let l;p(i.Q_.LOADING);let r={...n};if(console.log("Previous context:",r),r.name=g,r.description=y||null,console.log("New context:",r),d&&(r.context=d),n?l=await x.updateContext(n.stream_id,r):(l=await x.createContext(r),r.stream_id=l.doc),console.log("res:",l),200==l.status){let t=new FormData;t.append("file",v),t.append("context",JSON.stringify(r)),console.log("body:",t);let n=await fetch("/api/settings/add-context",{method:"POST",body:t}),l=await n.json();console.log("data:",l),200==l.status?(s&&s(l.context),f(l.settings),p(i.Q_.SUCCESS),await (0,i._v)(500),p(i.Q_.ACTIVE),c&&c()):p(i.Q_.ERROR)}else p(i.Q_.ERROR),alert("There was an error updating the Ceramic stream.")};return(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("input",{type:"text",placeholder:"Context name",className:"bg-white w-full mt-2 px-2 py-1 rounded-md border border-slate-300 text-base text-slate-900 mb-1.5",onChange:t=>h(t.target.value),value:g}),(0,l.jsx)("textarea",{type:"text",placeholder:"Context description",rows:"2",className:"bg-white w-full px-2 py-1 rounded-md border border-slate-300 text-base text-slate-900 mb-2",onChange:t=>w(t.target.value),value:y}),(0,l.jsxs)("div",{className:"flex flex-row items-center space-x-2 mb-2",children:[(0,l.jsx)("p",{className:"font-medium text-slate-900 text-base",children:"Logo:"}),C&&(0,l.jsx)("img",{src:C,className:"h-8 w-8 ml-2 rounded-md"}),(0,l.jsx)("input",{ref:S,type:"file",className:"hidden",accept:"image/png, image/jpeg, image/gif",onChange:t=>{if(t.target.files&&t.target.files[0]){let n=t.target.files[0];j(n),b(URL.createObjectURL(n))}}}),(0,l.jsx)(o.Z,{type:"secondary",onClick:()=>selectLogo(),title:"Upload logo"})]}),(0,l.jsx)("div",{className:"flex w-full justify-center mt-2",children:(0,l.jsx)(o.Z,{title:"Save",status:m,onClick:()=>uploadToServer()})})]})}},2478:function(t,n,s){s.d(n,{Z:function(){return AddContextModal}});var l=s(4246),r=s(7378),o=s(6640),a=s(662),i=s(7737),c=s(5620),d=s(8709),x=s(3279),u=s(9239);function AddContextModal(t){let{hide:n,parentContext:s}=t,[o,i]=(0,r.useState)(1);return(0,l.jsx)(a.Z,{hide:n,children:(0,l.jsxs)("div",{className:"flex flex-col justify-center",children:[(0,l.jsx)("h2",{className:"text-center font-medium mb-1",children:s?"Add a new sub-context":"Use a new context"}),(0,l.jsx)("p",{className:"text-center text-slate-500 text-base mb-2",children:"You can either create or use an existing context."}),(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(d.Z,{steps:["Type","Details","Save in settings"],currentStep:o})}),(0,l.jsx)(AddContextSteps,{step:o,setStep:i,parentContext:s,hide:n})]})})}let AddContextSteps=t=>{let{step:n,setStep:s,hide:a,parentContext:d}=t,{orbis:f,setSettings:m}=(0,r.useContext)(o.k),[p,g]=(0,r.useState)(null),[h,C]=(0,r.useState)(""),[b,v]=(0,r.useState)(""),[j,y]=(0,r.useState)(""),[w,S]=(0,r.useState)(x.Q_.ACTIVE),[N,_]=(0,r.useState)(x.Q_.ACTIVE),[E,A]=(0,r.useState)();async function loadContextDetails(){S(x.Q_.LOADING);try{let t=await f.ceramic.loadStream(h);if(console.log("stream.state:",t.state),t){let n={name:t.state.content.name,description:t.state.content.description,stream_id:h};A(n),S(x.Q_.SUCCESS),await (0,x._v)(500),s(3),S(x.Q_.ACTIVE)}else alert("Error loading context details."),console.log("Error loading context details and adding it to the settings file:",e),S(x.Q_.ERROR),await (0,x._v)(500),S(x.Q_.ACTIVE)}catch(t){alert("Couldn't load context details."),console.log("Error adding new context to the settings file:",t),S(x.Q_.ERROR),await (0,x._v)(500),S(x.Q_.ACTIVE)}}switch(n){case 1:return(0,l.jsx)("div",{className:"flex flex-col items-center",children:(0,l.jsxs)("div",{className:"space-y-2 flex flex-col mb-4 text-base mt-2 w-full",children:[(0,l.jsx)(ContextOption,{title:"Use existing context",description:"Add a context you created in the past.",isSelected:"existing"===p,onSelect:()=>{g("existing"),s(2)}}),(0,l.jsx)(ContextOption,{title:"Create new context",description:"Create a new context and start using it.",isSelected:"new"===p,onSelect:()=>{g("new"),s(2)}})]})});case 2:if("existing"==p)return(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("input",{type:"text",placeholder:"Context ID",className:"bg-white w-full mt-2 px-2 py-1 rounded-md border border-slate-300 text-base text-slate-900 mb-2",onChange:t=>C(t.target.value),value:h}),(0,l.jsx)(i.Z,{type:"primary",onClick:()=>(function(){if(2===n)switch(p){case"existing":if(""==h||!h){alert("Context ID can't be empty.");return}loadContextDetails();break;case"new":createNewContext()}})(),status:w,title:"Next"})]});if("new"==p)return(0,l.jsx)(c.Z,{callback:a,parentContext:d});case 3:return(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("p",{className:"text-base text-slate-900 mb-3 text-center",children:"We are now going to save this new context in your settings."}),(0,l.jsx)("div",{className:"w-full mb-3",children:(0,l.jsx)(u.ZP,{context:E})}),(0,l.jsx)(i.Z,{type:"primary",onClick:()=>saveInSettings(),status:w,title:"Save"})]})}},ContextOption=t=>{let{title:n,description:s,isSelected:r,onSelect:o}=t;return(0,l.jsxs)("div",{className:"rounded-md border border-slate-200 px-4 py-3 flex flex-col ".concat(r?"bg-[#eef5ff] border-[#4483fd] border":"hover:bg-slate-50"," cursor-pointer"),onClick:o,children:[(0,l.jsx)("p",{className:"font-medium ".concat(r?"text-slate-800":"text-slate-900"),children:n}),(0,l.jsx)("p",{className:"text-slate-600",children:s})]})}},662:function(t,n,s){s.d(n,{Z:function(){return Modal}});var l=s(4246),r=s(7378);function Modal(t){var n;let{hide:s,children:o,title:a,description:i,style:c,className:d}=t,x=(0,r.useRef)(null);return n=()=>s(),(0,r.useEffect)(()=>{let listener=t=>{!x.current||x.current.contains(t.target)||n(t)};return document.addEventListener("mousedown",listener),document.addEventListener("touchstart",listener),()=>{document.removeEventListener("mousedown",listener),document.removeEventListener("touchstart",listener)}},[x,n]),(0,l.jsxs)("div",{className:"relative z-10","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",style:c,children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity blur-md backdrop-blur-sm cursor-pointer"}),(0,l.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,l.jsx)("div",{className:"flex min-h-full items-start justify-center p-6 text-center sm:p-0 ",children:(0,l.jsxs)("div",{className:"relative transform rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 w-96 sm:p-6 "+d,ref:x,children:[a&&(0,l.jsx)("h2",{className:"text-center font-medium mb-1 w-full",children:a}),i&&(0,l.jsx)("p",{className:"text-slate-500 text-base w-full text-center mb-1",children:i}),o]})})})]})}},8709:function(t,n,s){s.d(n,{Z:function(){return StepsProgress}});var l=s(4246);function StepsProgress(t){let{steps:n=[],currentStep:s=1}=t;return(0,l.jsx)("ol",{className:"relative flex items-center w-full text-sm font-medium text-center mt-4 mb-3 justify-center",children:n.map((t,r)=>(0,l.jsxs)("li",{className:"flex items-center justify-center ".concat(r<n.length-1?"mr-2":""),children:[(0,l.jsxs)("span",{className:"flex justify-end flex-col items-center",children:[s==r+1&&(0,l.jsx)("span",{className:"text-sm text-[#4483FD] absolute",style:{top:-17},children:t}),(0,l.jsx)("span",{className:"rounded-full h-3 w-3 mt-1 ".concat(s>=r+1?"bg-[#4483FD]":"bg-slate-200")})]}),r<n.length-1&&(0,l.jsx)("span",{className:"h-1 border-b ml-2 w-16 ".concat(s>r+1?"border-[#4483FD]":"border-slate-200")})]},r))})}},3279:function(t,n,s){s.d(n,{Q_:function(){return l},SL:function(){return function findContextById(t,n){if(t&&Array.isArray(t))for(let s of t){if(s.stream_id===n)return s;if(s.contexts&&Array.isArray(s.contexts)){let t=findContextById(s.contexts,n);if(t)return t}}return null}},_v:function(){return sleep},d2:function(){return getPluginsByContext},oK:function(){return findParentContextId}}),s(7378),s(6640);let sleep=t=>new Promise(n=>setTimeout(n,t)),getPluginsByContext=(t,n)=>{let s=[],l=[],r=((t,n)=>{for(let s of n)if(s.contexts){for(let n of s.contexts)if(n.context===t)return n.path.slice(0,-1)}return[]})(t,n);return n.forEach(n=>{var o;null==n||null===(o=n.contexts)||void 0===o||o.forEach(o=>{let a=o.context===t,i=r.includes(o.context),c=JSON.parse(JSON.stringify(n));delete c.contexts,a?s.push({...c,contextType:"Direct",installedContextId:o.context}):i&&l.push({...c,contextType:"Parent",installedContextId:o.context})})}),{direct:s,parent:l}},findParentContextId=function(t,n){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!n||0===n.length)return null;for(let l of n){if(l.stream_id===t)return s;if(l.contexts){let n=findParentContextId(t,l.contexts,l.stream_id);if(n)return n}}return null},l={ACTIVE:0,LOADING:1,SUCCESS:2,ERROR:3,DISABLED:4}}}]);